{"version":3,"sources":["../src/modal_book.js"],"names":["define","exports","$","ajax","ModalFactory","ModalEvents","Notification","Modal","CustomEvents","ModalRegistry","SELECTORS","CLOSE_BUTTON","CONTENT_BLOCK","CLOSE_CROSS","ROOT_MODAL","ModalBook","root","call","getFooter","find","length","exception","message","TYPE","prototype","Object","create","constructor","registerEventListeners","getModal","on","events","activate","e","preventDefault","stopPropagation","getRoot","trigger","bind","scrollBottom","id","currentTarget","attr","methodname","args","then","response","done","error","JSON","parse","code","alert","getBookResult","fail","target","remove","iframeBook","document","getElementById","contentWindow","open","write","close","register"],"mappings":"AAAAA,OAAM,yBAAC,CAAC,SAAD,CAAY,QAAZ,CAAsB,WAAtB,CAAmC,oBAAnC,CAAyD,mBAAzD,CACC,mBADD,CACsB,YADtB,CACoC,gCADpC,CACsE,qBADtE,CAAD,CAEF,SAAUC,CAAV,CAAmBC,CAAnB,CAAsBC,CAAtB,CAA4BC,CAA5B,CAA0CC,CAA1C,CACUC,CADV,CACwBC,CADxB,CAC+BC,CAD/B,CAC6CC,CAD7C,CAC4D,IAExDC,CAAAA,CAAS,CAAG,CACZC,YAAY,CAAE,8BADF,CAEZC,aAAa,CAAE,oCAFH,CAGZC,WAAW,CAAE,QAHD,CAIZC,UAAU,CAAE,iCAJA,CAF4C,CAcxDC,CAAS,CAAG,SAASC,CAAT,CAAe,CAC3BT,CAAK,CAACU,IAAN,CAAW,IAAX,CAAiBD,CAAjB,EAEA,GAAI,CAAC,KAAKE,SAAL,GAAiBC,IAAjB,CAAsBT,CAAS,CAACC,YAAhC,EAA8CS,MAAnD,CAA2D,CACvDd,CAAY,CAACe,SAAb,CAAuB,CAACC,OAAO,CAAE,wBAAV,CAAvB,CACH,CACJ,CApB2D,CAsB5DP,CAAS,CAACQ,IAAV,CAAiB,iBAAjB,CACAR,CAAS,CAACH,aAAV,CAA0BF,CAAS,CAACE,aAApC,CACAG,CAAS,CAACS,SAAV,CAAsBC,MAAM,CAACC,MAAP,CAAcnB,CAAK,CAACiB,SAApB,CAAtB,CACAT,CAAS,CAACS,SAAV,CAAoBG,WAApB,CAAkCZ,CAAlC,CAEAA,CAAS,CAACS,SAAV,CAAoBI,sBAApB,CAA6C,UAAY,CACrDrB,CAAK,CAACiB,SAAN,CAAgBI,sBAAhB,CAAuCX,IAAvC,CAA4C,IAA5C,EAEA,KAAKY,QAAL,GAAgBC,EAAhB,CAAmBtB,CAAY,CAACuB,MAAb,CAAoBC,QAAvC,CAAiDtB,CAAS,CAACC,YAA3D,CAAyE,SAAUsB,CAAV,CAAa,CAClFA,CAAC,CAACC,cAAF,GACAD,CAAC,CAACE,eAAF,GACA,KAAKC,OAAL,GAAeC,OAAf,CAAuB,OAAvB,CACH,CAJwE,CAIvEC,IAJuE,CAIlE,IAJkE,CAAzE,EAKA,KAAKT,QAAL,GAAgBC,EAAhB,CAAmBtB,CAAY,CAACuB,MAAb,CAAoBQ,YAAvC,CAAqD7B,CAAS,CAACE,aAA/D,CAA8E,SAAUqB,CAAV,CAAa,CACvF,GAAIO,CAAAA,CAAE,CAAG,CAACtC,CAAC,CAAC+B,CAAC,CAACQ,aAAH,CAAD,CAAmBC,IAAnB,CAAwB,SAAxB,CAAD,CAAT,CACAvC,CAAI,CAACc,IAAL,CAAU,CACN,CAAC0B,UAAU,CAAE,yBAAb,CAAwCC,IAAI,CAAE,CACtCJ,EAAE,CAAEA,CADkC,CAA9C,CADM,CAAV,EAIG,CAJH,EAIMK,IAJN,CAIW,SAAUC,CAAV,CAAoB,CAC3B,MAAOA,CAAAA,CACV,CAND,EAOAC,IAPA,CAOK,SAAUD,CAAV,CAAoB,CACrB,GAAIE,CAAAA,CAAK,CAAGC,IAAI,CAACC,KAAL,CAAWJ,CAAQ,KAAnB,EAA6BE,KAAzC,CACA,GAAIA,CAAK,EAAmB,GAAf,GAAAA,CAAK,CAACG,IAAnB,CAAiC,CAE7BC,KAAK,+WAAL,CACArC,CAAS,CAACS,SAAV,CAAoB6B,aAApB,+WACH,CAJD,IAKK,CACDtC,CAAS,CAACS,SAAV,CAAoB6B,aAApB,CAAkCP,CAAQ,KAA1C,CACH,CACJ,CAjBD,EAiBGQ,IAjBH,CAiBQ,SAAUR,CAAV,CAAoB,CACxBM,KAAK,CAACN,CAAD,CACR,CAnBD,CAoBH,CAtBD,EAuBA,KAAKjB,QAAL,GAAgBC,EAAhB,CAAmBtB,CAAY,CAACuB,MAAb,CAAoBC,QAAvC,CAAiDtB,CAAS,CAACG,WAA3D,CAAwE,SAAUoB,CAAV,CAAa,CACjFA,CAAC,CAACC,cAAF,GACAD,CAAC,CAACE,eAAF,GACA,KAAKC,OAAL,GAAeC,OAAf,CAAuB,OAAvB,CACH,CAJuE,CAItEC,IAJsE,CAIjE,IAJiE,CAAxE,EAKA,KAAKF,OAAL,GAAeN,EAAf,CAAkBtB,CAAY,CAACuB,MAAb,CAAoBC,QAAtC,CAAgD,SAAUC,CAAV,CAAa,CACzD,GAAIjB,CAAAA,CAAI,CAAGd,CAAC,CAACQ,CAAS,CAACI,UAAX,CAAZ,CACA,GAAkB,CAAd,CAAAE,CAAI,CAACI,MAAT,CAAqB,CACjBJ,CAAI,CAAGA,CAAI,CAAC,CAAD,CACd,CAFD,IAGK,CACDA,CAAI,CAAGA,CAAI,CAAC,CAAD,CACd,CACD,GAAIiB,CAAC,CAACsB,MAAF,GAAavC,CAAjB,CAAuB,CACnB,KAAKoB,OAAL,GAAeoB,MAAf,EACH,CACD,QACH,CAZ+C,CAY9ClB,IAZ8C,CAYzC,IAZyC,CAAhD,CAaH,CAjDD,CAmDAvB,CAAS,CAACS,SAAV,CAAoB6B,aAApB,CAAoC,SAAUP,CAAV,CAAoB,CAEpD,GAAIW,CAAAA,CAAU,CAAGC,QAAQ,CAACC,cAAT,CAAwB,aAAxB,CAAjB,CACAF,CAAU,CAACG,aAAX,CAAyBF,QAAzB,CAAkCG,IAAlC,GACAJ,CAAU,CAACG,aAAX,CAAyBF,QAAzB,CAAkCI,KAAlC,CAAwChB,CAAxC,EACAW,CAAU,CAACG,aAAX,CAAyBF,QAAzB,CAAkCK,KAAlC,EACH,CAND,CASAtD,CAAa,CAACuD,QAAd,CAAuBjD,CAAS,CAACQ,IAAjC,CAAuCR,CAAvC,CAAkD,uBAAlD,EAEA,MAAOA,CAAAA,CACV,CA7FK,CAAN","sourcesContent":["define([\"exports\", \"jquery\", \"core/ajax\", \"core/modal_factory\", \"core/modal_events\",\n        \"core/notification\", \"core/modal\", \"core/custom_interaction_events\", \"core/modal_registry\"],\n    function (exports, $, ajax, ModalFactory, ModalEvents,\n              Notification, Modal, CustomEvents, ModalRegistry) {\n\n    let SELECTORS = {\n        CLOSE_BUTTON: \"[data-action='close_button']\",\n        CONTENT_BLOCK: \"[data-action='book_content_block']\",\n        CLOSE_CROSS: \".close\",\n        ROOT_MODAL: \"[data-region='modal-container']\",\n\n    };\n\n    /**\n     * Constructor for the Modal\n     *\n     */\n    let ModalBook = function(root) {\n        Modal.call(this, root);\n\n        if (!this.getFooter().find(SELECTORS.CLOSE_BUTTON).length) {\n            Notification.exception({message: 'close button not found'});\n        }\n    };\n\n    ModalBook.TYPE = 'mod_lanebs-book';\n    ModalBook.CONTENT_BLOCK = SELECTORS.CONTENT_BLOCK;\n    ModalBook.prototype = Object.create(Modal.prototype);\n    ModalBook.prototype.constructor = ModalBook;\n\n    ModalBook.prototype.registerEventListeners = function () {\n        Modal.prototype.registerEventListeners.call(this);\n\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.CLOSE_BUTTON, function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.getRoot().trigger('click');\n        }.bind(this));\n        this.getModal().on(CustomEvents.events.scrollBottom, SELECTORS.CONTENT_BLOCK, function (e) {\n            let id = [$(e.currentTarget).attr('data-id')];\n            ajax.call([\n                {methodname: 'mod_lanebs_book_content', args: {\n                        id: id\n                    }}\n            ])[0].then(function (response) {\n                return response;\n            }).\n            done(function (response) {\n                let error = JSON.parse(response['body']).error;\n                if (error && error.code === 404) {\n                    let errorMsg = 'Ресурс отсутствует в Вашем пользовании. Обратитесь к администратору.';\n                    alert(errorMsg);\n                    ModalBook.prototype.getBookResult(errorMsg);\n                }\n                else {\n                    ModalBook.prototype.getBookResult(response['body']);\n                }\n            }).fail(function (response) {\n                alert(response);\n            });\n        });\n        this.getModal().on(CustomEvents.events.activate, SELECTORS.CLOSE_CROSS, function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.getRoot().trigger('click');\n        }.bind(this));\n        this.getRoot().on(CustomEvents.events.activate, function (e) {\n            let root = $(SELECTORS.ROOT_MODAL);\n            if (root.length > 1) { // потому что эта модалка иногда вторая (после поиска), а иногда первая, внутри модуля.\n                root = root[1];    // Костыль, но что делать\n            }\n            else {\n                root = root[0];\n            }\n            if (e.target === root) {\n                this.getRoot().remove();\n            }\n            return true;\n        }.bind(this));\n    };\n\n    ModalBook.prototype.getBookResult = function (response) {\n        //console.log(response);\n        let iframeBook = document.getElementById('book_iframe');\n        iframeBook.contentWindow.document.open();\n        iframeBook.contentWindow.document.write(response);\n        iframeBook.contentWindow.document.close();\n    };\n\n\n    ModalRegistry.register(ModalBook.TYPE, ModalBook, 'mod_lanebs/modal_book');\n\n    return ModalBook;\n});"],"file":"modal_book.min.js"}