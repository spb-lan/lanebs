define(["exports","jquery","core/ajax","core/modal_factory","core/modal_events","core/notification","core/modal","core/custom_interaction_events","core/modal_registry"],function(t,e,o,n,i,r,c,a,s){let l="[data-action='close_button']",d="[data-action='book_content_block']",g=".close",u="[data-region='modal-container']",p=function(t){c.call(this,t),this.getFooter().find(l).length||r.exception({message:"close button not found"})};return p.TYPE="mod_lanebs-book",p.CONTENT_BLOCK=d,(p.prototype=Object.create(c.prototype)).constructor=p,p.prototype.registerEventListeners=function(){c.prototype.registerEventListeners.call(this),this.getModal().on(a.events.activate,l,function(t){t.preventDefault(),t.stopPropagation(),this.getRoot().trigger("click")}.bind(this)),this.getModal().on(a.events.scrollBottom,d,function(t){let n=[e(t.currentTarget).attr("data-id")];o.call([{methodname:"mod_lanebs_book_content",args:{id:n}}])[0].then(function(t){return t}).done(function(t){try{console.log(t);let e=JSON.parse(t.body).error;if(e&&404===e.code){let t="Ресурс отсутствует в Вашем пользовании. Обратитесь к администратору.";alert(t),p.prototype.getBookResult(t)}}catch(e){p.prototype.getBookResult(t.body)}}).fail(function(t){alert(t)})}),this.getModal().on(a.events.activate,g,function(t){t.preventDefault(),t.stopPropagation(),this.getRoot().trigger("click")}.bind(this)),this.getRoot().on(a.events.activate,function(t){let o=e(u);return o=o.length>1?o[1]:o[0],t.target===o&&this.getRoot().remove(),!0}.bind(this))},p.prototype.getBookResult=function(t){console.log(t);let e=document.getElementById("book_iframe");e.contentWindow.document.open(),e.contentWindow.document.write(t),e.contentWindow.document.close()},s.register(p.TYPE,p,"mod_lanebs/modal_book"),p});